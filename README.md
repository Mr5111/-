# mos_ws：基于ERASOR的实时静态建图
```shell
rostopic pub /saveflag std_msgs/Float32 "data: 0.2"
```



### SOTA

<table style="text-align:center;" border="1" align="center">
    <caption>SOTA Comparision</caption>
	<tr >
		<th> Sequence </th>
		<th> Method </th>
		<th> PR[%] </th>
		<th> RR[%] </th>
		<th> F1 </th>
    </tr>
    <tr>
        <td rowspan="6"> 00 </td>
        <td> Removert </td>
        <td> 86.83 </td>
        <td> 90.62 </td>
        <td> 0.887 </td>
    </tr>
    	<td> ERASOR </td>
        <td> 93.98 </td>
        <td> 97.08 </td>
        <td> 0.955 </td>
    <tr>
        <td> ERASOR2 </td>
        <th> 97.582 </th>
        <th> 98.992 </th>
        <th> 0.983 </th>
    </tr>
    <tr>
        <td> ERASOR++ </td>
        <td> 96.82 </td>
        <td> 96.10 </td>
        <td> 0.965 </td>
    </tr>
    <tr>
        <td> DynamicFilter </td>
        <td> 90.07 </td>
        <td> 91.09 </td>
        <td> 0.906 </td>
    </tr>
    <tr span style="color:#E53333;">
        <td> Ours </td>
        <td> 99.3718 </td>
        <td> 90.4703 </td>
        <td> 0.947123 </td>
    </tr>
    <tr>
        <td rowspan="6"> 01 </td>
        <td> Removert </td>
        <td> 95.82 </td>
        <td> 57.08 </td>
        <td> 0.715 </td>
    </tr>
    <tr>
    	<td> ERASOR </td>
        <td> 91.49 </td>
        <th> 95.38 </td>
        <td> 0.934 </td>
	</tr>
    <tr>
        <td> ERASOR2 </td>
        <td> 96.88 </th>
        <td> 94.63 </th>
        <td> 0.957 </th>
    </tr>
    <tr>
        <td> ERASOR++ </td>
        <th> 98.99 </td>
        <td> 93.64 </td>
        <th> 0.962 </td>
    </tr>
    <tr>
        <td> DynamicFilter </td>
        <td> 87.95 </td>
        <td> 87.69 </td>
        <td> 0.878 </td>
    </tr>
    <tr span style="color:#E53333;">
        <td> Ours </td>
        <td> 98.6831 </td>
        <td> 89.4621 </td>
        <td> 0.938466 </td>
    </tr>
    <tr>
        <td rowspan="6"> 02 </td>
        <td> Removert </td>
        <td> 83.29 </td>
        <td> 88.37 </td>
        <td> 0.858 </td>
    </tr>
    	<td> ERASOR </td>
        <td> 87.73 </td>
        <td> 97.01 </td>
        <td> 0.921 </td>
    <tr>
        <td> ERASOR2 </td>
        <th> 98.52 </th>
        <th> 99.71 </th>
        <th> 0.991 </th>
    </tr>
    <tr>
        <td> ERASOR++ </td>
        <td> 87.89 </td>
        <td> 98.90 </td>
        <td> 0.931 </td>
    </tr>
    <tr>
        <td> DynamicFilter </td>
        <td> 88.02 </td>
        <td> 86.10 </td>
        <td> 0.871 </td>
    </tr>
    <tr span style="color:#E53333;">
        <td> Ours </td>
        <td> 96.5039 </td>
        <td> 95.7108 </td>
        <td> 0.961057 </td>
    </tr>
  	<tr>
        <td rowspan="6"> 05 </td>
        <td> Removert </td>
        <td> 88.17 </td>
        <td> 79.98 </td>
        <td> 0.839 </td>
    </tr>
    	<td> ERASOR </td>
        <td> 88.73 </td>
        <td> 98.26 </td>
        <td> 0.921 </td>
    <tr>
        <td> ERASOR2 </td>
        <th> 97.58 </th>
        <th> 98.99 </th>
        <th> 0.983 </th>
    </tr>
    <tr>
        <td> ERASOR++ </td>
        <td> 96.53 </td>
        <td> 97.67 </td>
        <td> 0.971 </td>
    </tr>
    <tr>
        <td> DynamicFilter </td>
        <td> 90.17 </td>
        <td> 84.65 </td>
        <td> 0.873 </td>
    </tr>
    <tr span style="color:#E53333;">
        <td> Ours </td>
        <td> 99.843 </td>
        <td> 90.7055 </td>
        <td> 0.950552 </td>
    </tr>
    <tr>
        <td rowspan="6"> 07 </td>
        <td> Removert </td>
        <td> 82.04 </td>
        <td> 95.50 </td>
        <td> 0.883 </td>
    </tr>
    	<td> ERASOR </td>
        <td> 90.62 </td>
        <th> 99.27 </td>
        <td> 0.948 </td>
    <tr>
        <td> ERASOR2 </td>
        <th> 98.98 </th>
        <td> 98.46 </th>
        <th> 0.987 </th>
    </tr>
    <tr>
        <td> ERASOR++ </td>
        <td> 98.58 </td>
        <td> 98.65 </td>
        <td> 0.986 </td>
    </tr>
    <tr>
        <td> DynamicFilter </td>
        <td> 87.94 </td>
        <td> 86.80 </td>
        <td> 0.874 </td>
    </tr>
    <tr span style="color:#E53333;">
        <td> Ours </td>
        <td> 99.4462 </td>
        <td> 91.02 </td>
        <td> 0.950467 </td>
    </tr>
</table>




### v2.0

| seq  | stat. pts | dyn. pts |    %     | est. sta | est. dyn. pts |    %     | Preservation | rejection |    F1    |
| :--: | :-------: | :------: | :------: | :------: | :-----------: | :------: | :----------: | :-------: | :------: |
|  00  |  2074963  |   6053   | 0.291716 |  373307  |      900      | 0.241088 |   99.5915    |  81.8768  | 0.898695 |
|  01   | 4085380 |      58881 | 1.44126 |          1093839 |            5871 | 0.536733 |         99.322 |     84.8032 | 0.914902 |
|  02  |   1311426 |       7909 | 0.603084 |           355883 |             542 | 0.152297 |        98.8249 |     91.3516 | 0.949414 |
|  05  |     4839170 |      42887 | 0.886247 |           848772 |            6933 | 0.816827 |        99.9396 |      76.543 | 0.866904 |
|  07 |     2452146 |      44207 | 1.80279 |           245679 |            8172 | 3.32629 |        99.8783 |     69.6496 | 0.820689 |



### 动态置信概率的影响

+ $\text{dyn\_score\_th} = 0.5$

  | seq  | stat. pts | dyn. pts |    %     | est. sta | est. dyn. pts |    %     | Preservation | rejection |    F1    |
  | :--: | :-------: | :------: | :------: | :------: | :-----------: | :------: | :----------: | :-------: | :------: |
  |  00  |     2074963 |       6053 | 0.291716 |           372821 |             837 | 0.224505 |        99.5629 |     83.3636 | 0.90746 |
  |  01  |     4085380 |      58881 | 1.44126 |          1073761 |            5242 | 0.488191 |        98.7894 |     86.4761 | 0.922236 |
  |  02  |     1311426 |       7909 | 0.603084 |           355620 |             542 | 0.15241 |        98.8043 |      91.339 | 0.949251 
  |  05  |     4839170 |      42887 | 0.886247 |           848527 |            6033 | 0.710997 |        99.9363 |     79.1359 | 0.88328 |
  |  07  |     2452146 |      44207 | 1.80279 |           244904 |            6781 | 2.76884 |        99.8362 |     73.2124 | 0.844762 |


+ $\text{dyn\_score\_th} = 0.4$

  | seq  | stat. pts | dyn. pts |    %     | est. sta | est. dyn. pts |    %     | Preservation | rejection |    F1    |
  | :--: | :-------: | :------: | :------: | :------: | :-----------: | :------: | :----------: | :-------: | :------: |
  |  00  |     2074963 |       6053 | 0.291716 |           379637 |             700 | 0.184387 |        99.6158 |     86.6843 | 0.927012 |
  |  01  |     4085380 |      58881 | 1.44126 |          1072561 |            4819 | 0.449298 |         98.749 |     87.4662 | 0.927658 |
  |  02  |     1311426 |       7909 | 0.603084 |           354843 |             466 | 0.131326 |        98.7362 |     92.3505 | 0.954366 |
  |  05  |     4839170 |      42887 | 0.886247 |           848601 |            4944 | 0.582606 |        99.9316 |     84.0861 | 0.913266 |
  |  07  |  2452146  |  44207   | 1.80279  |  244201  |     6213      | 2.54422  |   99.7736    |  75.393   |0.858866|
  
+ $\text{dyn\_score\_th} = 0.3$

  | seq  | stat. pts | dyn. pts |    %     | est. sta | est. dyn. pts |    %     | Preservation | rejection |    F1    |
  | :--: | :-------: | :------: | :------: | :------: | :-----------: | :------: | :----------: | :-------: | :------: |
  |  00  |     2074963 |       6053 | 0.291716 |           371472 |             579 | 0.155866 |        99.4786 |      88.072 | 0.934285 |
  |  01  |     4085380 |      58881 | 1.44126 |          1069817 |            4616 | 0.431476 |        98.6621 |     87.9316 | 0.929883 |
  |  02  |     1311426 |       7909 | 0.603084 |           352789 |             376 | 0.106579 |        98.5694 |     93.4758 | 0.959551 |
  |  05  |     4839170 |      42887 | 0.886247 |           845529 |            4381 | 0.518137 |        99.8924 |     84.3612 | 0.914723 |
  |  07  |     2452146 |      44207 | 1.80279 |           240777 |            5303 | 2.20245 |        99.5665 |     76.6689 | 0.866302 |



### 不要遮挡原则判定的影响：$\text{dyn\_score\_th} = 0.4$

| seq  | stat. pts | dyn. pts |    %     | est. sta | est. dyn. pts |    %     | Preservation | rejection |    F1    |
| :--: | :-------: | :------: | :------: | :------: | :-----------: | :------: | :----------: | :-------: | :------: |
|  00  |     2074963 |       6053 | 0.291716 |           367014 |             620 | 0.168931 |        99.0563 |     87.5434 | 0.929447 |
|  01  |     4085380 |      58881 | 1.44126 |          1068419 |            4572 | 0.427922 |        98.5982 |     88.0793 | 0.930424 |
|  02  |     1311426 |       7909 | 0.603084 |           352677 |             331 | 0.0938536 |        98.4636 |     94.0448 | 0.962035 |
|  05  |     4839170 |      42887 | 0.886247 |           823932 |            2936 | 0.35634 |        99.1401 |     87.9427 | 0.932063 |
|  07  |     2452146 |      44207 | 1.80279 |           235907 |            3110 | 1.31832 |        99.2125 |     84.0048 | 0.909775 |



### 初始化过程累计地图达到最大数量：$\text{dyn\_score\_th} = 0.4$

| seq  | stat. pts | dyn. pts |    %     | est. sta | est. dyn. pts |     %     | Preservation | rejection |    F1    |
| :--: | :-------: | :------: | :------: | :------: | :-----------: | :-------: | :----------: | :-------: | :------: |
|  00  |     1770947 |       5555 | 0.313674 |           350405 |             576 | 0.164381 |         98.725 |     88.0288 | 0.930706 |
|  01  |     3594014 |      54808 | 1.52498 |           963145 |            4198 | 0.435864 |        96.6681 |     88.8483 | 0.925934 |
|  02  |     1080792 |       5275 | 0.488068 |           312355 |             231 | 0.0739543 |        96.3684 |     95.1469 | 0.957538 |
|  05  |     4517494 |      39745 | 0.879802 |           823308 |            2396 | 0.291021 |        99.0877 |     90.1849 | 0.944269 |
|  07  |     3596643 |      54808 | 1.52387 |          1017456 |            4314 | 0.423999 |        98.7077 |     88.5637 | 0.93361 |



### 重新加入遮挡原则判定的影响：$\text{dyn\_score\_th} = 0.4$

| seq  | stat. pts | dyn. pts |    %     | est. sta | est. dyn. pts |     %     | Preservation | rejection |    F1    |
| :--: | :-------: | :------: | :------: | :------: | :-----------: | :-------: | :----------: | :-------: | :------: |
|  00  |     1770983 |       5555 | 0.313668 |           354952 |             615 | 0.173263 |        99.2335 |     87.2907 | 0.928798 |
|  01  |     3597354 |      54809 | 1.52359 |          1022517 |            4474 | 0.437548 |        98.9014 |     88.0038 | 0.931349 |
|  02  |     1081152 |       5275 | 0.487905 |           315391 |             266 | 0.0843398 |        96.8706 |     94.4645 | 0.956524 |
|  05  |     4517498 |      39745 | 0.879801 |           845996 |            3311 | 0.391373 |        99.9063 |     87.6387 | 0.933713 |
|  07  |  3596643  |  54808   | 1.52387  | 1017456  |     4314      | 0.423999  |   98.7077    |  88.5637  |  0.9336  |



### 增大区域生长范围：$\text{dyn\_grow\_size} = 2$

| seq  | stat. pts | dyn. pts |    %     | est. sta | est. dyn. pts |     %     | Preservation | rejection |    F1    |
| :--: | :-------: | :------: | :------: | :------: | :-----------: | :-------: | :----------: | :-------: | :------: |
|  00  |     1823536 |       5614 | 0.307863 |           359413 |             477 | 0.132716 |        99.3718 |     90.4703 | 0.947123 |
|  01  |     3597329 |      54764 | 1.52235 |          1017708 |            4031 | 0.396086 |        98.6831 |     89.4621 | 0.938466 |
|  02  |     1080752 |       5269 | 0.487531 |           312002 |             207 | 0.0663457 |        96.5039 |     95.7108 | 0.961057 |
|  05  |     4517494 |      39744 | 0.87978 |           842692 |            2867 | 0.340219 |         99.843 |     90.7055 | 0.950552 |
|  07  |     2228440 |      34354 | 1.54162 |           232360 |            2015 | 0.867189 |        99.4462 |       91.02 | 0.950467 |



### 聚类阈值调整

| seq  | stat. pts | dyn. pts |    %     | est. sta | est. dyn. pts |     %     | Preservation | rejection |    F1    |
| :--: | :-------: | :------: | :------: | :------: | :-----------: | :-------: | :----------: | :-------: | :------: |
|  00  |     1769590 |       5488 | 0.310128 |           350503 |             352 | 0.100427 |        99.0198 |     93.0394 | 0.959365 |
|  01  |     3595750 |      54734 | 1.52219 |          1008387 |            3031 | 0.300579 |        98.3982 |     91.9118 | 0.950445 |
|  02  |     1079571 |       5250 | 0.486304 |           308060 |             152 | 0.049341 |        96.1399 |     96.9143 | 0.965255 |
|  05  |     4514574 |      39280 | 0.870071 |           836281 |            2297 | 0.274668 |        99.7649 |     92.4058 | 0.959445 |
|  07  |     2227182 |      34351 | 1.54235 |           230210 |            1591 | 0.691108 |        99.3516 |       92.76 | 0.959428 |



### 地面拟合阈值调整

| seq  | stat. pts | dyn. pts |    %     | est. sta | est. dyn. pts |    %     | Preservation | rejection |    F1    |
| ---- | :-------: | :------: | :------: | :------: | :-----------: | :------: | :----------: | :-------: | :------: |
|  00  |     1769574 |       5488 | 0.310131 |           350452 |             348 | 0.0993003 |        99.0176 |     93.1122 | 0.959741 |
|  01  |     3595728 |      54734 | 1.5222 |          1008165 |            2829 | 0.280609 |        98.3944 |     92.5257 | 0.953698 |
|  02  |     1079571 |       5250 | 0.486304 |           308033 |             150 | 0.0486961 |        96.1384 |     96.9524 | 0.965437 |
|  05  |     4514574 |      39280 | 0.870071 |           836177 |            2241 | 0.268005 |        99.7623 |     92.6731 | 0.960871 |
|  07  |     2227182 |      34351 | 1.54235 |           230186 |            1579 | 0.685967 |          99.35 |     92.8386 | 0.95984 |



### 动态生长&高度判断

- max_h_thr: 1.5

| seq  | stat. pts | dyn. pts |    %     | est. sta | est. dyn. pts |     %     | Preservation | rejection |    F1    |
| ---- | :-------: | :------: | :------: | :------: | :-----------: | :-------: | :----------: | :-------: | :------: |
| 00   |  1769597  |   5488   | 0.310127 |  351735  |      423      | 0.120261  |   99.1491    |  91.1625  | 0.949882 |
| 01   |  3663258  |  55377   | 1.51169  | 1032943  |     3232      | 0.312892  |   99.1227    |  91.3556  | 0.950808 |
| 02   |  1080256  |   5264   | 0.487292 |  310778  |      204      | 0.0656417 |   96.5173    |  95.6497  | 0.960815 |
| 05   |  4576896  |  39541   | 0.863926 |  838637  |     2780      |  0.33149  |    99.833    |  90.152   | 0.947458 |
| 07   |  2227153  |  34364   | 1.54296  |  230727  |     1957      | 0.848189  |   99.5031    |  91.075   | 0.951027 |

- max_h_thr: 2

| seq  | stat. pts | dyn. pts |    %     | est. sta | est. dyn. pts |     %     | Preservation | rejection |    F1    |
| ---- | :-------: | :------: | :------: | :------: | :-----------: | :-------: | :----------: | :-------: | :------: |
| 00   |  1822191  |   5546   | 0.304359 |  358480  |      436      | 0.121625  |   99.4037    |  91.0386  | 0.950374 |
| 01   |  3663338  |  55377   | 1.51165  | 1039920  |     3251      |  0.31262  |   99.2488    |  91.3809  | 0.951525 |
| 02   |  1080256  |   5264   | 0.487292 |  311871  |      213      | 0.0682975 |   96.5989    |  95.4787  | 0.960355 |
| 05   |  4514579  |  39281   | 0.870092 |  840597  |     2726      | 0.324293  |    99.857    |  90.2701  | 0.948219 |
| 07   |  2269852  |  34994   | 1.54169  |  234368  |     1985      | 0.846959  |    99.583    |  91.2099  | 0.952127 |

- max_h_thr: 1

| seq  | stat. pts | dyn. pts |    %     | est. sta | est. dyn. pts |     %     | Preservation | rejection |    F1    |
| ---- | :-------: | :------: | :------: | :------: | :-----------: | :-------: | :----------: | :-------: | :------: |
| 00   |  1769587  |   5488   | 0.310129 |  349480  |      444      | 0.127046  |   99.0642    |  90.6888  | 0.946916 |
| 01   |  3594851  |  54733   | 1.52254  | 1000000  |     3122      |  0.3122   |    98.422    |  91.4951  | 0.948322 |
| 02   |  1078850  |   5266   | 0.488112 |  304431  |      222      | 0.0729229 |   95.7777    |  95.3285  | 0.955526 |
| 05   |  4514566  |  39281   | 0.870095 |  831453  |     2777      | 0.333994  |   99.6972    |  90.1861  | 0.947034 |
| 07   |  2227081  |  34365   | 1.54305  |  228750  |     1957      | 0.855519  |   99.4393    |  91.049   | 0.950594 |

- max_h_thr: 0.5

| seq  | stat. pts | dyn. pts |    %     | est. sta | est. dyn. pts |     %     | Preservation | rejection |    F1    |
| ---- | :-------: | :------: | :------: | :------: | :-----------: | :-------: | :----------: | :-------: | :------: |
| 00   |  1769364  |   5488   | 0.310168 |  344869  |      436      | 0.126425  |   98.8614    |  91.2172  | 0.948856 |
| 01   |  3661361  |  55377   | 1.51247  | 1011753  |     3333      | 0.329428  |   98.6138    |  91.0595  | 0.946862 |
| 02   |  1076014  |   5266   | 0.489399 |  294467  |      201      | 0.0682589 |    94.361    |  95.8033  | 0.950767 |
| 05   |  4514375  |  39282   | 0.870154 |  822337  |     2704      | 0.328819  |   99.5016    |  90.726   | 0.949114 |
| 07   |  2227025  |  34365   | 1.54309  |  224280  |     1934      | 0.862315  |   99.1543    |   91.18   | 0.950001 |



### POTENTIAL_BIN扩大

- 2圈

| seq  | stat. pts | dyn. pts |    %     | est. sta | est. dyn. pts |     %     | Preservation | rejection |    F1    |
| ---- | :-------: | :------: | :------: | :------: | :-----------: | :-------: | :----------: | :-------: | :------: |
| 00   |  1768151  |   5488   | 0.310381 |  328043  |      219      | 0.0667595 |    97.272    |  95.6815  | 0.964702 |
| 01   |  3591367  |  54725   | 1.52379  |  942867  |     2292      | 0.243088  |   96.1552    |  94.0704  | 0.951014 |
| 02   |  1070541  |   5250   | 0.490406 |  270938  |      140      | 0.0516723 |   90.4672    |  97.181   | 0.93704  |
| 05   |  4513757  |  39277   | 0.870162 |  792515  |     1515      | 0.191164  |   98.6493    |  95.6641  | 0.971338 |
| 07   |  2268086  |  34972   | 1.54192  |  216178  |      763      |  0.35295  |   98.3032    |  97.0548  | 0.97675  |
